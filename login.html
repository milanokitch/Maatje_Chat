<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inloggen - Maatje AI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <img src="images/logo_abrona.png" alt="Abrona Logo" class="auth-logo">
            <h2>Inloggen bij Maatje AI</h2>
            <p class="auth-subtitle">Log in om toegang te krijgen tot de chatbot</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">E-mailadres</label>
                    <input type="email" id="loginEmail" placeholder="jouw@email.nl" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Wachtwoord</label>
                    <input type="password" id="loginPassword" placeholder="Wachtwoord" required>
                </div>

                <div class="forgot-password">
                    <a href="#" id="forgotPasswordLink" style="font-size: 0.9rem; color: #666;">Wachtwoord vergeten?</a>
                </div>
                
                <button type="submit" class="auth-btn">Inloggen</button>
            </form>
            
            <div id="loginMessage" class="auth-message"></div>
            
            <p class="auth-switch">
                Nog geen account? <a href="register.html">Registreer hier</a>
            </p>
        </div>
    </div>

    <!-- Supabase client toevoegen -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabase client initialiseren
        const { createClient } = supabase;
        const supabaseClient = createClient(
            'https://fhynxjujbwxxdxegomki.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZoeW54anVqYnd4eGR4ZWdvbWtpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNjkyMzYsImV4cCI6MjA4MDg0NTIzNn0.tTXCi7ptSw1P6IVouGwTZt5DMbCcTZofqpXO-P0UA3k'
        );

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const messageDiv = document.getElementById('loginMessage');
            
            try {
                // Inloggen via Supabase
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) {
                    messageDiv.style.color = 'red';
                    messageDiv.textContent = 'Fout: ' + error.message;
                } else {
                    messageDiv.style.color = 'green';
                    messageDiv.textContent = 'Login succesvol! Je wordt doorgestuurd...';
                    console.log('âœ… Login succesvol:', data);
                    
                    // Doorsturen naar hoofdpagina na 1 seconde
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 1000);
                }
            } catch (err) {
                messageDiv.style.color = 'red';
                messageDiv.textContent = 'Er ging iets mis. Probeer het opnieuw.';
                console.error('Login error:', err);
            }
        });

        // Wachtwoord vergeten handler
        document.getElementById('forgotPasswordLink').addEventListener('click', async function(e) {
            e.preventDefault();
            
            // 1. Vraag om email
            const email = prompt("Vul je e-mailadres in om je wachtwoord te resetten:");
            
            if (email && email.trim() !== "") {
                try {
                    // 2. Stuur reset verzoek
                    const { data, error } = await supabaseClient.auth.resetPasswordForEmail(email.trim(), {
                        redirectTo: window.location.href // Stuurt gebruiker terug naar deze pagina na klikken in mail
                    });

                    if (error) {
                        alert("Fout bij aanvragen: " + error.message);
                    } else {
                        alert("Check je e-mail voor de herstel-link!");
                    }
                } catch (err) {
                    console.error("Reset error:", err);
                    alert("Er ging iets mis. Probeer het later opnieuw.");
                }
            }
        });
    </script>
</body>
</html>
