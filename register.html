<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registreren - Maatje AI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <img src="images/logo_abrona.png" alt="Abrona Logo" class="auth-logo">
            <h2>Registreren bij Maatje AI</h2>
            <p class="auth-subtitle">Maak een account aan om te chatten</p>
            
            <form id="registerForm">
                <div class="form-group">
                    <label for="firstName">Voornaam</label>
                    <input type="text" id="firstName" placeholder="Jouw voornaam" required>
                </div>

                <div class="form-group">
                    <label for="regEmail">E-mailadres</label>
                    <input type="email" id="regEmail" placeholder="jouw@email.nl" required>
                </div>

                <div class="form-group">
                    <label for="caretakerEmail">E-mailadres Begeleider</label>
                    <input type="email" id="caretakerEmail" placeholder="naam@abrona.nl" required>
                </div>
                
                <div class="form-group">
                    <label for="regPassword">Wachtwoord</label>
                    <input type="password" id="regPassword" placeholder="Minimaal 6 tekens" required minlength="6">
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Herhaal Wachtwoord</label>
                    <input type="password" id="confirmPassword" placeholder="Typ wachtwoord nog eens" required>
                </div>
                
                <button type="submit" class="auth-btn">Account aanmaken</button>
            </form>
            
            <div id="registerMessage" class="auth-message"></div>
            
            <p class="auth-switch">
                Al een account? <a href="login.html">Log hier in</a>
            </p>
        </div>
    </div>

    <!-- Supabase client toevoegen -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabase client initialiseren
        const { createClient } = supabase;
        const supabaseClient = createClient(
            'https://fhynxjujbwxxdxegomki.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZoeW54anVqYnd4eGR4ZWdvbWtpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNjkyMzYsImV4cCI6MjA4MDg0NTIzNn0.tTXCi7ptSw1P6IVouGwTZt5DMbCcTZofqpXO-P0UA3k'
        );

        // Registratie form handler
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const firstName = document.getElementById('firstName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const caretakerEmail = document.getElementById('caretakerEmail').value.trim();
            const password = document.getElementById('regPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            const messageDiv = document.getElementById('registerMessage');
            
            // 1. Validatie: Wachtwoorden checken
            if (password !== confirmPassword) {
                alert("Wachtwoorden zijn niet gelijk!");
                return;
            }

            try {
                // Registreren via Supabase Auth
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        emailRedirectTo: window.location.origin,
                        data: {
                            full_name: firstName, // We slaan de voornaam op in het full_name veld
                            caretaker_email: caretakerEmail // Hier slaan we de begeleider op
                        }
                    }
                });
                
                if (error) {
                    messageDiv.style.color = 'red';
                    messageDiv.textContent = 'Fout: ' + error.message;
                } else {
                    messageDiv.style.color = 'green';
                    
                    // Check of email confirmatie vereist is
                    if (data.user && data.user.identities && data.user.identities.length === 0) {
                        messageDiv.textContent = '✅ Account bestaat al. Stuur je door naar login...';
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                    } else {
                        // Email confirmatie vereist of direct ingelogd
                        alert("Account aangemaakt! Check je e-mail om je account te activeren.");
                        messageDiv.textContent = '✅ Account aangemaakt! Check je e-mail voor bevestiging en log daarna in.';
                        console.log('✅ Registratie succesvol:', data);
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 1500);
                    }
                }
            } catch (err) {
                messageDiv.style.color = 'red';
                messageDiv.textContent = 'Er ging iets mis. Probeer het opnieuw.';
                console.error('Registratie error:', err);
            }
        });
    </script>
</body>
</html>
